

<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dojo/data/ItemFileWriteStore &mdash; The Dojo Toolkit - Reference Guide</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="The Dojo Toolkit - Reference Guide" href="../../index.html" />
    <link rel="up" title="Dojo" href="../contents.html" />
    <link rel="next" title="dojo.data.ObjectStore" href="ObjectStore.html" />
    <link rel="prev" title="dojo/data/ItemFileReadStore" href="ItemFileReadStore.html" />

    <link rel="stylesheet" href="../../_static/css/site.css">
    <link rel="stylesheet" href="../../_static/js/docs/resources/guide.css">
	<script type="text/javascript">
		dojoConfig = {
			async: true
		};
	</script>
    <script type="text/javascript" src="../../_static/js/dojo/dojo.js"></script>
    <script type="text/javascript" src="../../_static/js/docs/guide.js"></script>

  </head>
  <body>  

    <div class="document">
    <div id="accessibilityNode">
        <a href="#intro">Skip to Content</a> | <a href="#nav">Skip to Navigation</a>
    </div>
    <hr class="hide">
    <div id="page" class="docPage">
        <div id="header">
            <div class="container">
                <span id="logo"><a title="Home" href="http://dojotoolkit.org">
                    <img alt="Dojo Toolkit" src="../../_static/images/logo.png"></a>
                </span>
                <ul id="navigation">
                    <li class="home"><a href="/"><span class="homeIcon"></span></a></li>
                    <li class="download"><a href="/download/">Download</a></li>
                    <li class="features"><a href="/features/">Features</a></li>
                    <li class="docs active"><a href="/documentation/">Documentation</a></li>
                    <li class="community"><a href="/community/">Community</a></li>
                    <li class="about"><a href="/blog/">Blog</a></li>
                </ul>
            </div>
        </div>
    
        <hr class="hide" />
    
        <div id="main">
            <div id="content" class="innerBox">
                <div class="pageTitleContainer">
                    <h1>Documentation</h1>
                    <ul class="subnav">
                        <li><a href="/documentation/"><span>Tutorials</span></a></li>
                        <li class="active"><a href="/reference-guide/"><span>Reference Guide</span></a></li>
                        <li><a href="/api/"><span>API Documentation</span></a></li>
                    </ul>
                </div>
                <div class="line">
                    <div class="unit size3of4 firstUnit">
                        <div class="spacer">
                            
  <div class="section" id="dojo-data-itemfilewritestore">
<span id="id1"></span><h1><a class="toc-backref" href="#id2">dojo/data/ItemFileWriteStore</a><a class="headerlink" href="#dojo-data-itemfilewritestore" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Jared Jurkiewicz</td>
</tr>
<tr class="field-even field"><th class="field-name">since:</th><td class="field-body">V1.0</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dojo-data-itemfilewritestore" id="id2">dojo/data/ItemFileWriteStore</a><ul>
<li><a class="reference internal" href="#api-support" id="id3">API Support</a></li>
<li><a class="reference internal" href="#constructor-parameters" id="id4">Constructor Parameters</a></li>
<li><a class="reference internal" href="#custom-types" id="id5">Custom Types</a></li>
<li><a class="reference internal" href="#query-syntax" id="id6">Query Syntax</a></li>
<li><a class="reference internal" href="#the-write-api" id="id7">The Write API</a></li>
<li><a class="reference internal" href="#the-notification-api" id="id8">The Notification API</a></li>
<li><a class="reference internal" href="#pseudocode-examples" id="id9">Pseudocode Examples</a></li>
<li><a class="reference internal" href="#functional-examples" id="id10">Functional Examples</a></li>
</ul>
</li>
</ul>
</div>
<p><em>Deprecated</em>, <a class="reference internal" href="../store.html#dojo-store"><em>dojo/store</em></a> will eventually replace the <tt class="docutils literal"><span class="pre">dojo/data</span></tt> API.</p>
<p>Dojo core provides the ItemFileWriteStore store as an extension to ItemFileReadStore that adds on the dojo.data.api.Write and dojo.data.api.Notification API support to ItemFileReadStore. It was specifically created as a separate class so that if you only need read capability, you do not incur the download penalty of the write and notification API support if you won&#8217;t use it. If your application needs to write to the ItemFileStore instead of just Read, then ItemFileWriteStore is the store you should instantiate. The input data format is identical to <a class="reference internal" href="ItemFileReadStore.html#dojo-data-itemfilereadstore"><em>ItemFileReadStore</em></a>.</p>
<div class="section" id="api-support">
<h2><a class="toc-backref" href="#id3">API Support</a><a class="headerlink" href="#api-support" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="api/Read.html#dojo-data-api-read"><em>dojo.data.api.Read</em></a></li>
<li><a class="reference internal" href="api/Write.html#dojo-data-api-write"><em>dojo.data.api.Write</em></a></li>
<li><a class="reference internal" href="api/Identity.html#dojo-data-api-identity"><em>dojo.data.api.Identity</em></a></li>
<li><a class="reference internal" href="api/Notification.html#dojo-data-api-notification"><em>dojo.data.api.Notification</em></a></li>
</ul>
</div>
<div class="section" id="constructor-parameters">
<h2><a class="toc-backref" href="#id4">Constructor Parameters</a><a class="headerlink" href="#constructor-parameters" title="Permalink to this headline">¶</a></h2>
<p>The constructor for ItemFileWriteStore takes the same parameters as <a class="reference internal" href="ItemFileReadStore.html#dojo-data-itemfilereadstore"><em>dojo/data/ItemFileReadStore</em></a></p>
</div>
<div class="section" id="custom-types">
<h2><a class="toc-backref" href="#id5">Custom Types</a><a class="headerlink" href="#custom-types" title="Permalink to this headline">¶</a></h2>
<p>As with dojo/data/ItemFileReadStore, the ItemFileWriteStore supports using custom defined types in the data format. Since ItemFileWriteStore supports mechanisms for serializing the store contents back out, the custom type support has been extended to allow for custom serializers so that the complex types can be converted back into their necessary encodings.</p>
<div class="section" id="custom-type-examples">
<h3>Custom Type Examples<a class="headerlink" href="#custom-type-examples" title="Permalink to this headline">¶</a></h3>
<p>By default, ItemFileWriteStore has registered a custom type handler for JavaScript Date objects. It uses the general case formatting option for the value, as shown below:</p>
<div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;Date&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nb">Date</span><span class="p">,</span>
        <span class="nx">deserialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">){</span>
            <span class="k">return</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nx">stamp</span><span class="p">.</span><span class="nx">fromISOString</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">serialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
            <span class="k">return</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nx">stamp</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="p">{</span><span class="nx">zulu</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{
    &quot;Date&quot;: {
        type: Date,
        deserialize: function(value){
            return dojo.date.stamp.fromISOString(value);
        },
        serialize: function(obj){
            return dojo.date.stamp.toISOString(obj, {zulu:true});
        }
    }
}</textarea></div><p>So, when Date objects are encountered, ItemFileWriteStore automatically serializes it out as a custom type of the following format:</p>
<div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="s2">&quot;1993-05-24T00:00:00Z&quot;</span> <span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{ &quot;_type&quot;:&quot;Date&quot;, &quot;value&quot;:&quot;1993-05-24T00:00:00Z&quot; }</textarea></div></div>
</div>
<div class="section" id="query-syntax">
<h2><a class="toc-backref" href="#id6">Query Syntax</a><a class="headerlink" href="#query-syntax" title="Permalink to this headline">¶</a></h2>
<p>The query syntax for ItemFileWriteStore is identical to the query syntax of ItemFileReadStore so see that <a class="reference internal" href="ItemFileReadStore.html#dojo-data-itemfilereadstore"><em>section</em></a>  for more information.</p>
</div>
<div class="section" id="the-write-api">
<h2><a class="toc-backref" href="#id7">The Write API</a><a class="headerlink" href="#the-write-api" title="Permalink to this headline">¶</a></h2>
<p>The write API implementation conforms to the dojo.data specification for Write. Ultimately, the best way to think about it is that you use functions <em>newItem</em>, <em>deleteItem</em>, <em>setValue(s)</em>, and <em>unsetAttribute</em> to modify contents of the store. These changes can be undone all in one function call by calling the store <em>revert</em> function, or they can be committed and made unreversible by the <em>save</em> function. Think of it as semi-transactional.</p>
<div class="section" id="newitem-deleteitem-save-and-identities">
<h3>newItem(), deleteItem, save() and identities<a class="headerlink" href="#newitem-deleteitem-save-and-identities" title="Permalink to this headline">¶</a></h3>
<p>Care must be taken when defining an attribute that acts as an identifier for ItemFileWriteStore.  By defining it, you are in control of ensuring it remains unique.  This particularly matters with newItem and deleteItem.  ItemFileWriteStore uses the identifier to track changes.  This means that even if you delete an item, the identity of that item remains reserved and &#8216;in use&#8217;.  So, if you go call newItem() and try to reuse the identifier you will get an exception.  The way to clear this issue and reuse the identifier is to commit your changes by calling save().  Save will apply all current changes and clear any pending state, including reserved identifiers.</p>
<p>The reason this does not occur when you do not specify an identifier is that the store is auto-creating them for you and it makes sure they always remain unique.  In the auto-create case, the identifier isn&#8217;t even exposed as a public attribute (there is no way to get it via a getValue call, only getIdentity can do it).  So by &#8216;re-inserting an item, all you effectively do is create an entirely new item with a new identity, and since it has a new identity, there is no collision.</p>
</div>
<div class="section" id="the-behavior-of-the-save-api">
<h3>The Behavior of the save() API<a class="headerlink" href="#the-behavior-of-the-save-api" title="Permalink to this headline">¶</a></h3>
<p>Since this store implements the dojo.data.api.Write feature, it must implement the <em>save</em> function. Since this is an in-memory data store, what exactly does <em>save</em> do when called?  By default, it only does three things:</p>
<ul class="simple">
<li>Clear out the record of all changed, deleted, and new items so that isDirty() will return false.</li>
<li>Commit the changes to the internal main tree of items.</li>
<li>Call any callbacks passed to the save function.</li>
</ul>
<p>Okay, so it effectively removed the ability to revert out a set of changes. In other words, it acts like a commit. That&#8217;s great, bit all of it just happens in the browser. What if I want to send data back to a server when save is called for persistence?  Can this be done?  The answer is <strong>yes</strong>. There are several ways to accomplish this. The first would be to simply replace the store <em>save</em> function with a different one to do whatever you want. However, that one ends up requiring knowing a lot about how things are stored internally, which is not always good to know about. So, ItemFileWriteStore provides hook functions for users to over-ride to customize saving behavior without having to replace the <em>save</em> function. This allows for you to define exactly what else you want the store to do with saved data results without having to know as much about internal representations:  The functions you can over-ride are defined below:</p>
</div>
<div class="section" id="save-function-extension-point-saveeverything">
<h3>Save function Extension point: _saveEverything<a class="headerlink" href="#save-function-extension-point-saveeverything" title="Permalink to this headline">¶</a></h3>
<p>The <em>_saveEverything</em> function should be defined on your store when all you want to do is get text content of the internal state back into a JSONable string so it can be sent serverside. Effectively think of it as a way to get a JSON string back similar to the one you used to load the store. The callbacks are the same callbacks you normally pass to the <em>save</em> function of the store.</p>
<div class="highlight"><pre><span class="nx">_saveEverything</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">saveCompleteCallback</span> <span class="cm">/*Your callback to call when save is completed */</span><span class="p">,</span>
                          <span class="nx">saveFailedCallback</span> <span class="cm">/*Your callback to call if save fails*/</span><span class="p">,</span>
                          <span class="nx">newFileContentString</span> <span class="cm">/*The generated JSON data to send somewhere*/</span><span class="p">)</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">_saveEverything: function(saveCompleteCallback /*Your callback to call when save is completed */,
                          saveFailedCallback /*Your callback to call if save fails*/,
                          newFileContentString /*The generated JSON data to send somewhere*/)</textarea></div></div>
<div class="section" id="save-function-extension-point-savecustom">
<h3>Save function Extension point: _saveCustom<a class="headerlink" href="#save-function-extension-point-savecustom" title="Permalink to this headline">¶</a></h3>
<p>The <em>_saveCustom</em> function should be defined on your store when you want to control exactly how everything gets serialized back (be it in JSON, XML, or whatnot). The function signature is simple, it just takes the callbacks passed to the <em>save</em> API on the store. Your implementation should introspect through the store&#8217;s information, generate the save format your service desires, then send it and call the callbacks on whether it succeeds or not. The <em>_saveCustom</em> function should be declared on the store as follows:</p>
<div class="highlight"><pre><span class="nx">_saveCustom</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">saveCompleteCallback</span> <span class="cm">/*Your callback to call when save is completed */</span><span class="p">,</span>
                      <span class="nx">saveFailedCallback</span> <span class="cm">/*Your callback to call if save fails*/</span><span class="p">)</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">_saveCustom: function(saveCompleteCallback /*Your callback to call when save is completed */,
                      saveFailedCallback /*Your callback to call if save fails*/)</textarea></div></div>
<div class="section" id="the-behavior-of-the-revert-api">
<h3>The Behavior of the revert() API<a class="headerlink" href="#the-behavior-of-the-revert-api" title="Permalink to this headline">¶</a></h3>
<p>The revert API is intended to undo changes made through calls to <em>newItem</em>, <em>deleteItem</em>, and <em>setValue(s)</em>. What it effectively does is return the pristine data item states into the internal data array storing all the items for modified and deleted items. For new items it removes them from the internal data array.</p>
<blockquote>
<div><strong>Note:</strong>  Revert does <strong>not</strong> generate Notification events in reverse order for every change it undoes. To detect revert changes to react accordingly, you should <em>dojo.connect</em> to the revert function on the store.</div></blockquote>
</div>
<div class="section" id="referential-integrity">
<h3>Referential Integrity<a class="headerlink" href="#referential-integrity" title="Permalink to this headline">¶</a></h3>
<p>As of dojo 1.1, dojo/data/ItemFileWriteStore Write actions are reference aware. This means that if you delete an item that is referenced by other items, then those other items are also updated to remove those references. This will also generate Notification events when it occurs.</p>
<p>To put it more simply, say you have Item C which is referenced by Items A and B. If you delete Item C, a deleteItem event occurs, then two onSet notifications will occur; one for Item A and one for Item B, indicating that the attribute that referenced Item C was modified because Item C was deleted.</p>
</div>
</div>
<div class="section" id="the-notification-api">
<h2><a class="toc-backref" href="#id8">The Notification API</a><a class="headerlink" href="#the-notification-api" title="Permalink to this headline">¶</a></h2>
<p>ItemFileWriteStore supports dojo.data.api.Notification. This means that every action through <em>newItem</em>, <em>setValue(s)</em>, <em>unsetAttribute</em>, and <em>deleteItem</em> will generate events to indicate these actions. These events are functions on the store that widgets and user code can <em>dojo.connect</em> to. This allows for pages to be very dynamic in that a change from one widget in a data store can be detected and reacted to in another. For more details on Notification in general, please refer to the <a class="reference internal" href="api/Notification.html#dojo-data-api-notification"><em>Notification section</em></a> of the dojo.data API.</p>
</div>
<div class="section" id="pseudocode-examples">
<h2><a class="toc-backref" href="#id9">Pseudocode Examples</a><a class="headerlink" href="#pseudocode-examples" title="Permalink to this headline">¶</a></h2>
<p>For these examples, we&#8217;ll assume a datasource as defined by the following example data:</p>
<div class="highlight"><pre><span class="p">{</span> <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;abbr&#39;</span><span class="p">,</span>
  <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
  <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;ec&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Ecuador&#39;</span><span class="p">,</span>           <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Quito&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;eg&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Egypt&#39;</span><span class="p">,</span>             <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Cairo&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;El Salvador&#39;</span><span class="p">,</span>       <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;San Salvador&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;gq&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Equatorial Guinea&#39;</span><span class="p">,</span> <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Malabo&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;er&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Eritrea&#39;</span><span class="p">,</span>           <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Asmara&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Estonia&#39;</span><span class="p">,</span>           <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Tallinn&#39;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">abbr</span><span class="o">:</span><span class="s1">&#39;et&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Ethiopia&#39;</span><span class="p">,</span>          <span class="nx">capital</span><span class="o">:</span><span class="s1">&#39;Addis Ababa&#39;</span> <span class="p">}</span>
<span class="p">]}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{ identifier: 'abbr',
  label: 'name',
  items: [
    { abbr:'ec', name:'Ecuador',           capital:'Quito' },
    { abbr:'eg', name:'Egypt',             capital:'Cairo' },
    { abbr:'sv', name:'El Salvador',       capital:'San Salvador' },
    { abbr:'gq', name:'Equatorial Guinea', capital:'Malabo' },
    { abbr:'er', name:'Eritrea',           capital:'Asmara' },
    { abbr:'ee', name:'Estonia',           capital:'Tallinn' },
    { abbr:'et', name:'Ethiopia',          capital:'Addis Ababa' }
]}</textarea></div><div class="section" id="add-in-a-new-country">
<h3>Add in a new country<a class="headerlink" href="#add-in-a-new-country" title="Permalink to this headline">¶</a></h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemFileWriteStore</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;countries.json&quot;</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">usa</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">newItem</span><span class="p">({</span><span class="nx">abbr</span><span class="o">:</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;United States of America&#39;</span><span class="p">,</span> <span class="nx">capital</span><span class="o">:</span> <span class="s1">&#39;Washington DC&#39;</span><span class="p">});</span>

<span class="kd">function</span> <span class="nx">saveDone</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Done saving.&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">saveFailed</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Save failed.&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span><span class="nx">onComplete</span><span class="o">:</span> <span class="nx">saveDone</span><span class="p">,</span> <span class="nx">onError</span><span class="o">:</span> <span class="nx">saveFailed</span><span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var store = new ItemFileWriteStore({url: &quot;countries.json&quot;});
var usa = store.newItem({abbr: 'us', name: 'United States of America', capital: 'Washington DC'});

function saveDone(){
  alert(&quot;Done saving.&quot;);
}
function saveFailed(){
  alert(&quot;Save failed.&quot;);
}
store.save({onComplete: saveDone, onError: saveFailed});</textarea></div></div>
<div class="section" id="delete-a-country">
<h3>Delete a country<a class="headerlink" href="#delete-a-country" title="Permalink to this headline">¶</a></h3>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ItemFileWriteStore</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;countries.json&quot;</span><span class="p">});</span>

<span class="kd">function</span> <span class="nx">saveDone</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Done saving.&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">saveFailed</span><span class="p">(){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Save failed.&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">gotNames</span><span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Deleted country: &quot;</span> <span class="o">+</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">deleteItem</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span><span class="nx">onComplete</span><span class="o">:</span> <span class="nx">saveDone</span><span class="p">,</span> <span class="nx">onError</span><span class="o">:</span> <span class="nx">saveFailed</span><span class="p">});</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Egypt&quot;</span><span class="p">},</span> <span class="nx">queryOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">ignoreCase</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">gotNames</span><span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var store = new ItemFileWriteStore({url: &quot;countries.json&quot;});

function saveDone(){
  alert(&quot;Done saving.&quot;);
}
function saveFailed(){
  alert(&quot;Save failed.&quot;);
}
var gotNames= function(items, request){
  for(var i = 0; i &lt; items.length; i++){
    console.log(&quot;Deleted country: &quot; + store.getLabel(item);
    store.deleteItem(items[i]);
  }
  store.save({onComplete: saveDone, onError: saveFailed});
}
var request = store.fetch({query: {name:&quot;Egypt&quot;}, queryOptions: {ignoreCase: true}, onComplete: gotNames}</textarea></div></div>
</div>
<div class="section" id="functional-examples">
<h2><a class="toc-backref" href="#id10">Functional Examples</a><a class="headerlink" href="#functional-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="itemfilewritestore-changes-reflected-in-dojox-data-datagrid">
<h3>ItemFileWriteStore changes reflected in dojox.data.DataGrid<a class="headerlink" href="#itemfilewritestore-changes-reflected-in-dojox-data-datagrid" title="Permalink to this headline">¶</a></h3>
<p>The following is a semi-complex example of the write API in action. In this example, there is a number spinner, a button, and the DataGrid. You use the number spinner to select a value. Then by pressing the button, a query to ItemFileWriteStore is made. The results of that query are iterated over and <em>setValue</em> is called on each item to modify its population attribute (or add it if it did not exist). The DataGrid is used to display results. Since the DataGrid is dojo.data.Notification aware, it binds to the DataStore and listens for change events on items. If an item is updated, then the grid automatically reflects it in its display. In this example, changing the population for all items should result in all rows showing a change in the population column when the button is pressed.</p>
<div data-dojo-type="docs.MiniGlass" class="CodeGlassMini" data-dojo-props="type: 'dialog', pluginArgs:{ dojoConfig: 'parseOnLoad: true', version:'' }, width:'700', height:'400', toolbar:'', themename:'claro'"><div class="CodeGlassMiniInner"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">geoData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Egypt&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Kenya&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Nairobi&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mombasa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Sudan&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Khartoum&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Asia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;China&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;India&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Russia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mongolia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Commonwealth of Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Europe&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Germany&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Spain&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Italy&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;North America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>  <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;108 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;1,972,550 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico City&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;19 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Guadalajara&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;4 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Canada&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;33 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;9,984,670 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Ottawa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;0.9 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Toronto&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;2.5 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span> <span class="p">}]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;United States of America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;South America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Brazil&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;186 million&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Argentina&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;40 million&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">layoutGeo</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">[</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Geography Type&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;auto&#39;</span> <span class="p">}</span>
<span class="p">]</span>
<span class="p">];</span>

<span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo/ready&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/on&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/data/ItemFileWriteStore&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/Button&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/NumberSpinner&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/TextBox&quot;</span><span class="p">,</span> <span class="s2">&quot;dojox/grid/DataGrid&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/parser&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ready</span><span class="p">,</span> <span class="nx">on</span><span class="p">){</span>
    <span class="c1">// This function performs some basic dojo initialization. In this case it connects the button</span>
    <span class="c1">// onClick to a function which invokes the fetch(). The fetch function queries for all items</span>
    <span class="c1">// and provides callbacks to use for completion of data retrieval or reporting of errors.</span>
    <span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// Function to perform a fetch on the datastore when a button is clicked</span>
        <span class="kd">function</span> <span class="nx">updateAll</span><span class="p">(){</span>
            <span class="c1">// Callback for processing a returned list of items.</span>
            <span class="kd">function</span> <span class="nx">gotAll</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">spinner</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span> <span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="nx">geoStore</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// Callback for if the lookup fails.</span>
            <span class="kd">function</span> <span class="nx">fetchFailed</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;lookup failed.&quot;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Fetch the data.</span>
            <span class="nx">geoStore</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span> <span class="p">{},</span> <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">gotAll</span><span class="p">,</span> <span class="nx">onError</span><span class="o">:</span> <span class="nx">fetchFailed</span><span class="p">,</span> <span class="nx">queryOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">deep</span><span class="o">:</span><span class="kc">true</span><span class="p">}});</span>
        <span class="p">}</span>
        <span class="c1">// Link the click event of the button to driving the fetch.</span>
        <span class="nx">on</span><span class="p">(</span><span class="nx">button2</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">updateAll</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var geoData = {
    identifier: 'name',
    label: 'name',
    items: [
        { name:'Africa', type:'continent', children:[
            { name:'Egypt', type:'country' },
            { name:'Kenya', type:'country', children:[
                { name:'Nairobi', type:'city' },
                { name:'Mombasa', type:'city' } ]
            },
            { name:'Sudan', type:'country', children:
                { name:'Khartoum', type:'city' }
            }
        ]},
        { name:'Asia', type:'continent', children:[
            { name:'China', type:'country' },
            { name:'India', type:'country' },
            { name:'Russia', type:'country' },
            { name:'Mongolia', type:'country' } ]
        },
        { name:'Australia', type:'continent', population:'21 million', children:
            { name:'Commonwealth of Australia', type:'country', population:'21 million'}
        },
        { name:'Europe', type:'continent', children:[
            { name:'Germany', type:'country' },
            { name:'France', type:'country' },
            { name:'Spain', type:'country' },
            { name:'Italy', type:'country' } ]
        },
        { name:'North America', type:'continent', children:[
            { name:'Mexico', type:'country',  population:'108 million', area:'1,972,550 sq km', children:[
                { name:'Mexico City', type:'city', population:'19 million', timezone:'-6 UTC'},
                { name:'Guadalajara', type:'city', population:'4 million', timezone:'-6 UTC' } ]
            },
            { name:'Canada', type:'country', population:'33 million', area:'9,984,670 sq km', children:[
                { name:'Ottawa', type:'city', population:'0.9 million', timezone:'-5 UTC'},
                { name:'Toronto', type:'city', population:'2.5 million', timezone:'-5 UTC' }]
            },
            { name:'United States of America', type:'country' } ]
        },
        { name:'South America', type:'continent', children:[
            { name:'Brazil', type:'country', population:'186 million' },
            { name:'Argentina', type:'country', population:'40 million' } ]
        }
    ]
};

var layoutGeo = [
[
    { field: &quot;name&quot;, name: &quot;Name&quot;, width: 10 },
    { field: &quot;type&quot;, name: &quot;Geography Type&quot;, width: 10 },
    { field: &quot;population&quot;, name: &quot;Population&quot;, width: 'auto' }
]
];

require([&quot;dojo/ready&quot;, &quot;dojo/on&quot;, &quot;dojo/data/ItemFileWriteStore&quot;, &quot;dijit/form/Button&quot;, &quot;dijit/form/NumberSpinner&quot;, &quot;dijit/form/TextBox&quot;, &quot;dojox/grid/DataGrid&quot;, &quot;dojo/parser&quot;], function(ready, on){
    // This function performs some basic dojo initialization. In this case it connects the button
    // onClick to a function which invokes the fetch(). The fetch function queries for all items
    // and provides callbacks to use for completion of data retrieval or reporting of errors.
    ready(function(){
        // Function to perform a fetch on the datastore when a button is clicked
        function updateAll(){
            // Callback for processing a returned list of items.
            function gotAll(items, request){
                var value = spinner.getValue();
                if( value &gt;= 0 ){
                    var i;
                    for(i = 0; i &lt; items.length; i++){
                        var item = items[i];
                        geoStore.setValue(item, &quot;population&quot;, value);
                    }
                }
            }

            // Callback for if the lookup fails.
            function fetchFailed(error, request){
                alert(&quot;lookup failed.&quot; + error);
            }

            // Fetch the data.
            geoStore.fetch({query: {}, onComplete: gotAll, onError: fetchFailed, queryOptions: {deep:true}});
        }
        // Link the click event of the button to driving the fetch.
        on(button2, &quot;click&quot;, updateAll);
    });
});</textarea></div><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dojo/data/ItemFileWriteStore&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;data:geoData&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;geoStore&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;b&gt;</span>Set the population to assign to all items<span class="nt">&lt;/b&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/form/NumberSpinner&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;spinner&quot;</span> <span class="na">value=</span><span class="s">&quot;10000&quot;</span><span class="nt">&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/form/Button&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;button2&quot;</span><span class="nt">&gt;</span>Update all geography items populations!<span class="nt">&lt;/div&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;grid&quot;</span>
  <span class="na">style=</span><span class="s">&quot;width: 400px; height: 300px;&quot;</span>
  <span class="na">data-dojo-type=</span><span class="s">&quot;dojox/grid/DataGrid&quot;</span>
  <span class="na">data-dojo-props=</span><span class="s">&quot;store:geoStore,</span>
<span class="s">  structure:layoutGeo,</span>
<span class="s">  query:{},</span>
<span class="s">  queryOptions:{&#39;deep&#39;:true},</span>
<span class="s">  rowsPerPage:40&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;div data-dojo-type=&quot;dojo/data/ItemFileWriteStore&quot; data-dojo-props=&quot;data:geoData&quot; data-dojo-id=&quot;geoStore&quot;&gt;&lt;/div&gt;
&lt;b&gt;Set the population to assign to all items&lt;/b&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/form/NumberSpinner&quot; data-dojo-id=&quot;spinner&quot; value=&quot;10000&quot;&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/form/Button&quot; data-dojo-id=&quot;button2&quot;&gt;Update all geography items populations!&lt;/div&gt;&lt;br&gt;
&lt;div id=&quot;grid&quot;
  style=&quot;width: 400px; height: 300px;&quot;
  data-dojo-type=&quot;dojox/grid/DataGrid&quot;
  data-dojo-props=&quot;store:geoStore,
  structure:layoutGeo,
  query:{},
  queryOptions:{'deep':true},
  rowsPerPage:40&quot;&gt;
&lt;/div&gt;</textarea></div><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;{{baseUrl}}dojox/grid/resources/Grid.css&quot;</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">&quot;{{baseUrl}}dojox/grid/resources/nihiloGrid.css&quot;</span><span class="p">;</span>

<span class="nc">.dojoxGrid</span> <span class="nt">table</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="css"><textarea style="display:none">&#64;import &quot;{{baseUrl}}dojox/grid/resources/Grid.css&quot;;
&#64;import &quot;{{baseUrl}}dojox/grid/resources/nihiloGrid.css&quot;;

.dojoxGrid table {
    margin: 0;
}</textarea></div></div></div></div>
<div class="section" id="itemfilewritestore-deletions-reflected-in-dijit-tree">
<h3>ItemFileWriteStore deletions reflected in dijit.Tree<a class="headerlink" href="#itemfilewritestore-deletions-reflected-in-dijit-tree" title="Permalink to this headline">¶</a></h3>
<p>This example demonstrates how to use a function such as <em>deleteItem</em>. In this case dijit.Tree is used to show a hierarchy of items. By pressing the delete button, all items that are of type city are deleted. Since the tree is dojo.data.api.Notification aware, it catches the delete event and updates its rendering accordingly.</p>
<div data-dojo-type="docs.MiniGlass" class="CodeGlassMini" data-dojo-props="type: 'dialog', pluginArgs:{ dojoConfig: 'parseOnLoad: true', version:'' }, width:'700', height:'400', toolbar:'', themename:'claro'"><div class="CodeGlassMiniInner"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">storeData2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Egypt&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Kenya&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Nairobi&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mombasa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Sudan&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Khartoum&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Asia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;China&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;India&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Russia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mongolia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Commonwealth of Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Europe&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Germany&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Spain&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Italy&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;North America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>  <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;108 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;1,972,550 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico City&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;19 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Guadalajara&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;4 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Canada&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>  <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;33 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;9,984,670 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Ottawa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;0.9 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Toronto&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;2.5 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span> <span class="p">}]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;United States of America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;South America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Brazil&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;186 million&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Argentina&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;40 million&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">};</span>

<span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo/ready&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/on&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/parser&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/data/ItemFileReadStore&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/data/ItemFileWriteStore&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/Button&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/Tree&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ready</span><span class="p">,</span> <span class="nx">on</span><span class="p">){</span>
    <span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">function</span> <span class="nx">deleteCities</span><span class="p">(){</span>
            <span class="kd">function</span> <span class="nx">gotCities</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">items</span> <span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="nx">geographyStore2</span><span class="p">.</span><span class="nx">deleteItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">geographyStore2</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span><span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;city&quot;</span><span class="p">},</span> <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">gotCities</span><span class="p">,</span> <span class="nx">queryOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">deep</span><span class="o">:</span><span class="kc">true</span><span class="p">}});</span>
        <span class="p">}</span>
        <span class="nx">on</span><span class="p">(</span><span class="nx">button3</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">deleteCities</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var storeData2 = {
    identifier: 'name',
    label: 'name',
    items: [
        { name:'Africa', type:'continent', children:[
            { name:'Egypt', type:'country' },
            { name:'Kenya', type:'country', children:[
                { name:'Nairobi', type:'city' },
                { name:'Mombasa', type:'city' } ]
            },
            { name:'Sudan', type:'country', children:
                { name:'Khartoum', type:'city' }
            }
        ]},
        { name:'Asia', type:'continent', children:[
            { name:'China', type:'country' },
            { name:'India', type:'country' },
            { name:'Russia', type:'country' },
            { name:'Mongolia', type:'country' } ]
        },
        { name:'Australia', type:'continent', population:'21 million', children:
            { name:'Commonwealth of Australia', type:'country', population:'21 million'}
        },
        { name:'Europe', type:'continent', children:[
            { name:'Germany', type:'country' },
            { name:'France', type:'country' },
            { name:'Spain', type:'country' },
            { name:'Italy', type:'country' } ]
        },
        { name:'North America', type:'continent', children:[
            { name:'Mexico', type:'country',  population:'108 million', area:'1,972,550 sq km', children:[
                { name:'Mexico City', type:'city', population:'19 million', timezone:'-6 UTC'},
                { name:'Guadalajara', type:'city', population:'4 million', timezone:'-6 UTC' } ]
            },
            { name:'Canada', type:'country',  population:'33 million', area:'9,984,670 sq km', children:[
                { name:'Ottawa', type:'city', population:'0.9 million', timezone:'-5 UTC'},
                { name:'Toronto', type:'city', population:'2.5 million', timezone:'-5 UTC' }]
            },
            { name:'United States of America', type:'country' } ]
        },
        { name:'South America', type:'continent', children:[
            { name:'Brazil', type:'country', population:'186 million' },
            { name:'Argentina', type:'country', population:'40 million' } ]
        }
    ]
};

require([&quot;dojo/ready&quot;, &quot;dojo/on&quot;, &quot;dojo/parser&quot;, &quot;dojo/data/ItemFileReadStore&quot;, &quot;dojo/data/ItemFileWriteStore&quot;, &quot;dijit/form/Button&quot;, &quot;dijit/Tree&quot;], function(ready, on){
    ready(function(){
        function deleteCities(){
            function gotCities(items, request){
                if(items ){
                    var i;
                    for(i = 0; i &lt; items.length; i++){
                        var item = items[i];
                        geographyStore2.deleteItem(item);
                    }
                }
            }
            geographyStore2.fetch({query:{type: &quot;city&quot;}, onComplete: gotCities, queryOptions: {deep:true}});
        }
        on(button3, &quot;click&quot;, deleteCities);
    });
});</textarea></div><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dojo/data/ItemFileWriteStore&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;data:storeData2&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;geographyStore2&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;b&gt;</span>Before pressing delete, be sure to expand out the tree so you can see nodes (items), being removed from it.<span class="nt">&lt;/b&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/form/Button&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;button3&quot;</span><span class="nt">&gt;</span>Delete All Cities!<span class="nt">&lt;/div&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/tree/ForestStoreModel&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;geographyModel2&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;store:geographyStore2, query:{type: &#39;continent&#39;}, rootId:&#39;Geography&#39;, rootLabel:&#39;Geography&#39;&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/Tree&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;model:geographyModel2&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;div data-dojo-type=&quot;dojo/data/ItemFileWriteStore&quot; data-dojo-props=&quot;data:storeData2&quot; data-dojo-id=&quot;geographyStore2&quot;&gt;&lt;/div&gt;
&lt;b&gt;Before pressing delete, be sure to expand out the tree so you can see nodes (items), being removed from it.&lt;/b&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/form/Button&quot; data-dojo-id=&quot;button3&quot;&gt;Delete All Cities!&lt;/div&gt;&lt;br&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/tree/ForestStoreModel&quot; data-dojo-id=&quot;geographyModel2&quot; data-dojo-props=&quot;store:geographyStore2, query:{type: 'continent'}, rootId:'Geography', rootLabel:'Geography'&quot;&gt;&lt;/div&gt;
&lt;div data-dojo-type=&quot;dijit/Tree&quot; data-dojo-props=&quot;model:geographyModel2&quot;&gt;&lt;/div&gt;</textarea></div></div></div></div>
<div class="section" id="itemfilewritestore-changes-reflected-in-dojox-data-datagrid-with-savecustom">
<h3>ItemFileWriteStore changes reflected in dojox/data/DataGrid (with _saveCustom)<a class="headerlink" href="#itemfilewritestore-changes-reflected-in-dojox-data-datagrid-with-savecustom" title="Permalink to this headline">¶</a></h3>
<p>The following is a semi-complex example of the write API in action. In this example, there is a number spinner, a button, and the DataGrid. You use the number spinner to select a value. Then by pressing the button, a query to ItemFileWriteStore is made. The results of that query are iterated over and <em>setValue</em> is called on each item to modify its population attribute (or add it if it did not exist). The DataGrid is used to display results. Since the DataGrid is dojo.data.Notification aware, it binds to the DataStore and listens for change events on items. If an item is updated, then the grid automatically reflects it in its display. In this example, changing the population for all items should result in all rows showing a change in the population column when the button is pressed.  In addition, save() is called on the store, which in turn invokes a custom save handler.  This custom save handler generated a serialized view of the changes to send back to some location.  This view
is displayed in an alert.</p>
<div data-dojo-type="docs.MiniGlass" class="CodeGlassMini" data-dojo-props="type: 'dialog', pluginArgs:{ dojoConfig: 'parseOnLoad: true', version:'' }, width:'700', height:'400', toolbar:'', themename:'claro'"><div class="CodeGlassMiniInner"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">geoData2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">identifier</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Egypt&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Kenya&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Nairobi&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mombasa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Sudan&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Khartoum&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Asia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;China&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;India&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Russia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mongolia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Commonwealth of Australia&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;21 million&#39;</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Europe&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Germany&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Spain&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Italy&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;North America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span>  <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;108 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;1,972,550 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Mexico City&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;19 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Guadalajara&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;4 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-6 UTC&#39;</span> <span class="p">}</span> <span class="p">]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Canada&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;33 million&#39;</span><span class="p">,</span> <span class="nx">area</span><span class="o">:</span><span class="s1">&#39;9,984,670 sq km&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Ottawa&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;0.9 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span><span class="p">},</span>
                <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Toronto&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;2.5 million&#39;</span><span class="p">,</span> <span class="nx">timezone</span><span class="o">:</span><span class="s1">&#39;-5 UTC&#39;</span> <span class="p">}]</span>
            <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;United States of America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;South America&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span><span class="p">[</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Brazil&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;186 million&#39;</span> <span class="p">},</span>
            <span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Argentina&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="nx">population</span><span class="o">:</span><span class="s1">&#39;40 million&#39;</span> <span class="p">}</span> <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">layoutGeo2</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">[</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Geography Type&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">field</span><span class="o">:</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="s1">&#39;auto&#39;</span> <span class="p">}</span>
<span class="p">]</span>
<span class="p">];</span>

<span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo/ready&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/on&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/_base/json&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/parser&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/data/ItemFileWriteStore&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/Button&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/NumberSpinner&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/form/TextBox&quot;</span><span class="p">,</span> <span class="s2">&quot;dojox/grid/DataGrid&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ready</span><span class="p">,</span> <span class="nx">on</span><span class="p">,</span> <span class="nx">json</span><span class="p">){</span>
    <span class="c1">// This function performs some basic dojo initialization. In this case it connects the button</span>
    <span class="c1">// onClick to a function which invokes the fetch(). The fetch function queries for all items</span>
    <span class="c1">// and provides callbacks to use for completion of data retrieval or reporting of errors.</span>
    <span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">itemToJS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="nx">item</span><span class="p">){</span>
            <span class="c1">// summary: Function to convert an item into a simple JS object.</span>
            <span class="c1">// store:</span>
            <span class="c1">//    The datastore the item came from.</span>
            <span class="c1">// item:</span>
            <span class="c1">//    The item in question.</span>
            <span class="kd">var</span> <span class="nx">js</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="nx">store</span><span class="p">){</span>
                <span class="c1">// Determine the attributes we need to process.</span>
                <span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getAttributes</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getValues</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                        <span class="k">if</span><span class="p">(</span><span class="nx">values</span><span class="p">){</span>
                            <span class="c1">// Handle multivalued and single-valued attributes.</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">){</span>
                                <span class="kd">var</span> <span class="nx">j</span><span class="p">;</span>
                                <span class="nx">js</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
                                <span class="k">for</span><span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">){</span>
                                    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
                                    <span class="c1">// Check that the value isn&#39;t another item. If it is, process it as an item.</span>
                                    <span class="k">if</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">isItem</span><span class="p">(</span><span class="nx">value</span><span class="p">)){</span>
                                        <span class="nx">js</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemToJS</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
                                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                        <span class="nx">js</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">isItem</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])){</span>
                                    <span class="nx">js</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">itemToJS</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                    <span class="nx">js</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">js</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">_saveCustom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">saveComplete</span><span class="p">,</span> <span class="nx">saveFailed</span><span class="p">){</span>
            <span class="c1">//  summary:</span>
            <span class="c1">//    This is a custom save function for the geoStore to allow emitting only the modified items as</span>
            <span class="c1">//    a block of JSON text.</span>
            <span class="kd">var</span> <span class="nx">changeSet</span>  <span class="o">=</span> <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">_pending</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">changes</span><span class="p">.</span><span class="nx">modified</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">changeSet</span><span class="p">.</span><span class="nx">_modifiedItems</span><span class="p">){</span>
                <span class="c1">// Use the identity to look up the current version of the item from the store&#39;s array</span>
                <span class="c1">// Can&#39;t use the object IN the modified items array because it is the saved state before modification.</span>
                <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="c1">// Find the modified item, it can be in one of two places to look up</span>
                <span class="c1">// Either by an explicit identity if it was specified, or by its index.</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">geoStore2</span><span class="p">.</span><span class="nx">_itemsByIdentity</span><span class="p">){</span>
                    <span class="nx">item</span> <span class="o">=</span> <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">_itemsByIdentity</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nx">item</span> <span class="o">=</span> <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">_arrayOfAllItems</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="nx">changes</span><span class="p">.</span><span class="nx">modified</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">itemToJS</span><span class="p">(</span><span class="nx">geoStore2</span><span class="p">,</span> <span class="nx">item</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">toJson</span><span class="p">(</span><span class="nx">changes</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
            <span class="nx">saveComplete</span><span class="p">();</span>
        <span class="p">};</span>


        <span class="c1">// Function to perform a fetch on the datastore when a button is clicked</span>
        <span class="kd">function</span> <span class="nx">updateAll</span><span class="p">(){</span>
            <span class="c1">// Callback for processing a returned list of items.</span>
            <span class="kd">function</span> <span class="nx">gotAll</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">spinner2</span><span class="p">.</span><span class="nx">getValue</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span> <span class="nx">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">){</span>
                    <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// Callback for if the lookup fails.</span>
            <span class="kd">function</span> <span class="nx">fetchFailed</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">request</span><span class="p">){</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;lookup failed.&quot;</span><span class="p">);</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Fetch the data.</span>
            <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;city&quot;</span><span class="p">},</span> <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">gotAll</span><span class="p">,</span> <span class="nx">onError</span><span class="o">:</span> <span class="nx">fetchFailed</span><span class="p">,</span> <span class="nx">queryOptions</span><span class="o">:</span> <span class="p">{</span><span class="nx">deep</span><span class="o">:</span><span class="kc">true</span><span class="p">}});</span>
        <span class="p">}</span>
        <span class="c1">// Link the click event of the button to driving the fetch.</span>
        <span class="nx">on</span><span class="p">(</span><span class="nx">button3</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">updateAll</span><span class="p">();</span>
            <span class="nx">geoStore2</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">var geoData2 = {
    identifier: 'name',
    label: 'name',
    items: [
        { name:'Africa', type:'continent', children:[
            { name:'Egypt', type:'country' },
            { name:'Kenya', type:'country', children:[
                { name:'Nairobi', type:'city' },
                { name:'Mombasa', type:'city' } ]
            },
            { name:'Sudan', type:'country', children:
                { name:'Khartoum', type:'city' }
            }
        ]},
        { name:'Asia', type:'continent', children:[
            { name:'China', type:'country' },
            { name:'India', type:'country' },
            { name:'Russia', type:'country' },
            { name:'Mongolia', type:'country' } ]
        },
        { name:'Australia', type:'continent', population:'21 million', children:
            { name:'Commonwealth of Australia', type:'country', population:'21 million'}
        },
        { name:'Europe', type:'continent', children:[
            { name:'Germany', type:'country' },
            { name:'France', type:'country' },
            { name:'Spain', type:'country' },
            { name:'Italy', type:'country' } ]
        },
        { name:'North America', type:'continent', children:[
            { name:'Mexico', type:'country',  population:'108 million', area:'1,972,550 sq km', children:[
                { name:'Mexico City', type:'city', population:'19 million', timezone:'-6 UTC'},
                { name:'Guadalajara', type:'city', population:'4 million', timezone:'-6 UTC' } ]
            },
            { name:'Canada', type:'country', population:'33 million', area:'9,984,670 sq km', children:[
                { name:'Ottawa', type:'city', population:'0.9 million', timezone:'-5 UTC'},
                { name:'Toronto', type:'city', population:'2.5 million', timezone:'-5 UTC' }]
            },
            { name:'United States of America', type:'country' } ]
        },
        { name:'South America', type:'continent', children:[
            { name:'Brazil', type:'country', population:'186 million' },
            { name:'Argentina', type:'country', population:'40 million' } ]
        }
    ]
};

var layoutGeo2 = [
[
    { field: &quot;name&quot;, name: &quot;Name&quot;, width: 10 },
    { field: &quot;type&quot;, name: &quot;Geography Type&quot;, width: 10 },
    { field: &quot;population&quot;, name: &quot;Population&quot;, width: 'auto' }
]
];

require([&quot;dojo/ready&quot;, &quot;dojo/on&quot;, &quot;dojo/_base/json&quot;, &quot;dojo/parser&quot;, &quot;dojo/data/ItemFileWriteStore&quot;, &quot;dijit/form/Button&quot;, &quot;dijit/form/NumberSpinner&quot;, &quot;dijit/form/TextBox&quot;, &quot;dojox/grid/DataGrid&quot;], function(ready, on, json){
    // This function performs some basic dojo initialization. In this case it connects the button
    // onClick to a function which invokes the fetch(). The fetch function queries for all items
    // and provides callbacks to use for completion of data retrieval or reporting of errors.
    ready(function(){
        var itemToJS = function(store, item){
            // summary: Function to convert an item into a simple JS object.
            // store:
            //    The datastore the item came from.
            // item:
            //    The item in question.
            var js = {};
            if(item &amp;&amp; store){
                // Determine the attributes we need to process.
                var attributes = store.getAttributes(item);
                if(attributes &amp;&amp; attributes.length &gt; 0){
                    var i;
                    for(i = 0; i &lt; attributes.length; i++){
                        var values = store.getValues(item, attributes[i]);
                        if(values){
                            // Handle multivalued and single-valued attributes.
                            if(values.length &gt; 1 ){
                                var j;
                                js[attributes[i]] = [];
                                for(j = 0; j &lt; values.length; j++ ){
                                    var value = values[j];
                                    // Check that the value isn't another item. If it is, process it as an item.
                                    if(store.isItem(value)){
                                        js[attributes[i]].push(itemToJS(store, value));
                                    }else{
                                        js[attributes[i]].push(value);
                                    }
                                }
                            }else{
                                if(store.isItem(values[0])){
                                    js[attributes[i]] = itemToJS(store, values[0]);
                                }else{
                                    js[attributes[i]] = values[0];
                                }
                            }
                        }
                    }
                }
            }
            return js;
        };

        geoStore2._saveCustom = function(saveComplete, saveFailed){
            //  summary:
            //    This is a custom save function for the geoStore to allow emitting only the modified items as
            //    a block of JSON text.
            var changeSet  = geoStore2._pending;
            var changes = {};
            changes.modified = [];
            for(var i in changeSet._modifiedItems){
                // Use the identity to look up the current version of the item from the store's array
                // Can't use the object IN the modified items array because it is the saved state before modification.
                var item = null;
                // Find the modified item, it can be in one of two places to look up
                // Either by an explicit identity if it was specified, or by its index.
                if(geoStore2._itemsByIdentity){
                    item = geoStore2._itemsByIdentity[i];
                }else{
                    item = geoStore2._arrayOfAllItems[i];
                }
                changes.modified.push(itemToJS(geoStore2, item));
            }
            alert(json.toJson(changes, true));
            saveComplete();
        };


        // Function to perform a fetch on the datastore when a button is clicked
        function updateAll(){
            // Callback for processing a returned list of items.
            function gotAll(items, request){
                var value = spinner2.getValue();
                if( value &gt;= 0 ){
                    var i;
                    for(i = 0; i &lt; items.length; i++){
                        var item = items[i];
                        geoStore2.setValue(item, &quot;population&quot;, value);
                    }
                }
            }

            // Callback for if the lookup fails.
            function fetchFailed(error, request){
                alert(&quot;lookup failed.&quot;);
                alert(error);
            }

            // Fetch the data.
            geoStore2.fetch({query: {type:&quot;city&quot;}, onComplete: gotAll, onError: fetchFailed, queryOptions: {deep:true}});
        }
        // Link the click event of the button to driving the fetch.
        on(button3, &quot;click&quot;, function(){
            updateAll();
            geoStore2.save();
        });
    });
});</textarea></div><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dojo/data/ItemFileWriteStore&quot;</span> <span class="na">data-dojo-props=</span><span class="s">&quot;data:geoData2&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;geoStore2&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;b&gt;</span>Set the population to assign to all items of type city<span class="nt">&lt;/b&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/form/NumberSpinner&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;spinner2&quot;</span> <span class="na">value=</span><span class="s">&quot;10000&quot;</span><span class="nt">&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">data-dojo-type=</span><span class="s">&quot;dijit/form/Button&quot;</span> <span class="na">data-dojo-id=</span><span class="s">&quot;button3&quot;</span><span class="nt">&gt;</span>Update all geography items of type city with a new population!<span class="nt">&lt;/div&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;grid2&quot;</span>
    <span class="na">style=</span><span class="s">&quot;width: 400px; height: 300px;&quot;</span>
    <span class="na">data-dojo-type=</span><span class="s">&quot;dojox.grid.DataGrid&quot;</span>
    <span class="na">data-dojo-props=</span><span class="s">&quot;store:geoStore2,</span>
<span class="s">    structure:layoutGeo2,</span>
<span class="s">    query:{},</span>
<span class="s">    queryOptions:{&#39;deep&#39;:true},</span>
<span class="s">    rowsPerPage:40&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="html"><textarea style="display:none">&lt;div data-dojo-type=&quot;dojo/data/ItemFileWriteStore&quot; data-dojo-props=&quot;data:geoData2&quot; data-dojo-id=&quot;geoStore2&quot;&gt;&lt;/div&gt;
&lt;b&gt;Set the population to assign to all items of type city&lt;/b&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/form/NumberSpinner&quot; data-dojo-id=&quot;spinner2&quot; value=&quot;10000&quot;&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;
&lt;div data-dojo-type=&quot;dijit/form/Button&quot; data-dojo-id=&quot;button3&quot;&gt;Update all geography items of type city with a new population!&lt;/div&gt;&lt;br&gt;&lt;br&gt;
&lt;div id=&quot;grid2&quot;
    style=&quot;width: 400px; height: 300px;&quot;
    data-dojo-type=&quot;dojox.grid.DataGrid&quot;
    data-dojo-props=&quot;store:geoStore2,
    structure:layoutGeo2,
    query:{},
    queryOptions:{'deep':true},
    rowsPerPage:40&quot;&gt;
&lt;/div&gt;</textarea></div><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;{{baseUrl}}dojox/grid/resources/Grid.css&quot;</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">&quot;{{baseUrl}}dojox/grid/resources/nihiloGrid.css&quot;</span><span class="p">;</span>
<span class="nc">.dojoxGrid</span> <span class="nt">table</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="css"><textarea style="display:none">&#64;import &quot;{{baseUrl}}dojox/grid/resources/Grid.css&quot;;
&#64;import &quot;{{baseUrl}}dojox/grid/resources/nihiloGrid.css&quot;;
.dojoxGrid table {
    margin: 0;
}</textarea></div></div></div></div>
</div>
</div>


                        </div>
                    </div>
                    <div class="sidebar unit size1of4 lastUnit">
                        <h4>Reference Guide</h4>
						<div id="dtkVersion">
							<label for="refver">Dojo Version</label>
							<select id="refver" name="refver">
								<option value="1.6">1.6</option>
								<option value="1.7">1.7</option>
								<option value="1.8" selected="selected">1.8</option>
                                <option value="1.9">1.9</option>
							</select>
						</div>
                        <ul>
                            <li><a href="../../index.html">Startpage</a></li>
                            <li><a href="../index.html">Dojo</a></li>
                            <li><a href="../../dijit/index.html">Dijit</a></li>
                            <li><a href="../../dojox/index.html">DojoX</a></li>
                        </ul>
                        
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">dojo/data/ItemFileWriteStore</a><ul>
<li><a class="reference internal" href="#api-support">API Support</a></li>
<li><a class="reference internal" href="#constructor-parameters">Constructor Parameters</a></li>
<li><a class="reference internal" href="#custom-types">Custom Types</a><ul>
<li><a class="reference internal" href="#custom-type-examples">Custom Type Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#query-syntax">Query Syntax</a></li>
<li><a class="reference internal" href="#the-write-api">The Write API</a><ul>
<li><a class="reference internal" href="#newitem-deleteitem-save-and-identities">newItem(), deleteItem, save() and identities</a></li>
<li><a class="reference internal" href="#the-behavior-of-the-save-api">The Behavior of the save() API</a></li>
<li><a class="reference internal" href="#save-function-extension-point-saveeverything">Save function Extension point: _saveEverything</a></li>
<li><a class="reference internal" href="#save-function-extension-point-savecustom">Save function Extension point: _saveCustom</a></li>
<li><a class="reference internal" href="#the-behavior-of-the-revert-api">The Behavior of the revert() API</a></li>
<li><a class="reference internal" href="#referential-integrity">Referential Integrity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-notification-api">The Notification API</a></li>
<li><a class="reference internal" href="#pseudocode-examples">Pseudocode Examples</a><ul>
<li><a class="reference internal" href="#add-in-a-new-country">Add in a new country</a></li>
<li><a class="reference internal" href="#delete-a-country">Delete a country</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-examples">Functional Examples</a><ul>
<li><a class="reference internal" href="#itemfilewritestore-changes-reflected-in-dojox-data-datagrid">ItemFileWriteStore changes reflected in dojox.data.DataGrid</a></li>
<li><a class="reference internal" href="#itemfilewritestore-deletions-reflected-in-dijit-tree">ItemFileWriteStore deletions reflected in dijit.Tree</a></li>
<li><a class="reference internal" href="#itemfilewritestore-changes-reflected-in-dojox-data-datagrid-with-savecustom">ItemFileWriteStore changes reflected in dojox/data/DataGrid (with _saveCustom)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ItemFileReadStore.html"
                        title="previous chapter">dojo/data/ItemFileReadStore</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ObjectStore.html"
                        title="next chapter">dojo.data.ObjectStore</a></p>
    <div id="searchbox" style="display: none">
        <h3>Quick search</h3>
        <form class="search" action="../../search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
         </form>
         <p class="searchtip" style="font-size: 90%">
             Enter search terms or a module, class or function name.
         </p>
    </div>
        </div>
      </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="hide" />
        <div id="foot">
            <div class="innerBox">
                <script type="text/javascript">document.write('<a href="https://docs.google.com/spreadsheet/viewform?hl=en_US&amp;formkey=dFlDcHEyaHMwbEd4MFBObkNrX0E1MFE6MQ&amp;entry_0=' + encodeURIComponent(window.location.href) + '">Error in the documentation? Can’t find what you are looking for? Let us know!</a>');</script>
                <div class="footer">
                      &copy; Copyright 2005-2012, Dojo Foundation.
                      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
                </div>
            </div>  
        </div>
        <script src="http://www.google.com/jsapi?key=ABQIAAAAbTW5DVaTIHKHQe5Q75sB0BSaOaO_TgJ5c3mtQFnk5JO2zD5dZBSGHlRJ8HAPlCQCEO_FxSmyNAHSLw" type="text/javascript"></script>
    </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>