

<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Hints about Migrating from 1.x to 1.7 &mdash; The Dojo Toolkit - Reference Guide</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="The Dojo Toolkit - Reference Guide" href="../index.html" />
    <link rel="next" title="Dojo 1.x to 2.0 migration guide" href="migration-2.0.html" />
    <link rel="prev" title="Release Notes Dojo Toolkit" href="index.html" />

    <link rel="stylesheet" href="../_static/css/site.css">
    <link rel="stylesheet" href="../_static/js/docs/resources/guide.css">
	<script type="text/javascript">
		dojoConfig = {
			async: true
		};
	</script>
    <script type="text/javascript" src="../_static/js/dojo/dojo.js"></script>
    <script type="text/javascript" src="../_static/js/docs/guide.js"></script>

  </head>
  <body>  

    <div class="document">
    <div id="accessibilityNode">
        <a href="#intro">Skip to Content</a> | <a href="#nav">Skip to Navigation</a>
    </div>
    <hr class="hide">
    <div id="page" class="docPage">
        <div id="header">
            <div class="container">
                <span id="logo"><a title="Home" href="http://dojotoolkit.org">
                    <img alt="Dojo Toolkit" src="../_static/images/logo.png"></a>
                </span>
                <ul id="navigation">
                    <li class="home"><a href="/"><span class="homeIcon"></span></a></li>
                    <li class="download"><a href="/download/">Download</a></li>
                    <li class="features"><a href="/features/">Features</a></li>
                    <li class="docs active"><a href="/documentation/">Documentation</a></li>
                    <li class="community"><a href="/community/">Community</a></li>
                    <li class="about"><a href="/blog/">Blog</a></li>
                </ul>
            </div>
        </div>
    
        <hr class="hide" />
    
        <div id="main">
            <div id="content" class="innerBox">
                <div class="pageTitleContainer">
                    <h1>Documentation</h1>
                    <ul class="subnav">
                        <li><a href="/documentation/"><span>Tutorials</span></a></li>
                        <li class="active"><a href="/reference-guide/"><span>Reference Guide</span></a></li>
                        <li><a href="/api/"><span>API Documentation</span></a></li>
                    </ul>
                </div>
                <div class="line">
                    <div class="unit size3of4 firstUnit">
                        <div class="spacer">
                            
  <div class="section" id="hints-about-migrating-from-1-x-to-1-7">
<span id="releasenotes-migration17"></span><h1><a class="toc-backref" href="#id1">Hints about Migrating from 1.x to 1.7</a><a class="headerlink" href="#hints-about-migrating-from-1-x-to-1-7" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#hints-about-migrating-from-1-x-to-1-7" id="id1">Hints about Migrating from 1.x to 1.7</a><ul>
<li><a class="reference internal" href="#backwards-compatibility" id="id2">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#basic-patterns-changed" id="id3">Basic Patterns, Changed</a></li>
<li><a class="reference internal" href="#the-hands-off-approach" id="id4">The Hands off Approach</a></li>
</ul>
</li>
</ul>
</div>
<p>This guide aims to serve as the quick-and-dirty/all-you-need-to-know about getting up to speed with Dojo&#8217;s new AMD-ready module loader and all the goodness that comes along with it.</p>
<p><strong>TODOC:</strong> dojo/i18n!, AMD nls bundles</p>
<div class="section" id="backwards-compatibility">
<h2><a class="toc-backref" href="#id2">Backwards Compatibility</a><a class="headerlink" href="#backwards-compatibility" title="Permalink to this headline">¶</a></h2>
<p>First and foremost, all the changes in Dojo 1.7 <strong>should</strong> be backwards compatible. If you have an existing codebase utilizing Dojo 1.x everything should &#8220;JustWork&#8221;. This guide is not for covering any regressions found, but rather aims to help a developer convert his/her codebase to the new AMD goodness.</p>
<p>This guide also assumes you have a basic working knowledge of the Dojo Toolkit, package system, and JavaScript.</p>
<p>You may see <strong>several</strong> examples and tutorials using a variety of syntax. Hopefully this guide will empower you to recognize the difference between major versions. For example:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dojo.event.*&quot;</span><span class="p">)</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.require(&quot;dojo.event.*&quot;)</textarea></div><p>Is a snippet of code from Dojo <strong>0.4</strong>. If you ever see an asterisk in a module name know that you are likely reading an outdated tutorial (with the exception of this guide or any other guides trying to show the difference). Likewise, many Dojo documentation tutorials read like:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;a.b.C&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;d.e.F&quot;</span><span class="p">);</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.provide(&quot;a.b.C&quot;);
dojo.require(&quot;d.e.F&quot;);</textarea></div><p>While this is still valid and will work with the &#8220;legacy synchronous loader&#8221;, the goal here is to teach about the new asynchronous/anonymous loader.</p>
</div>
<div class="section" id="basic-patterns-changed">
<h2><a class="toc-backref" href="#id3">Basic Patterns, Changed</a><a class="headerlink" href="#basic-patterns-changed" title="Permalink to this headline">¶</a></h2>
<p>A lot of little syntax changes have occurred, as well as a number of fundamental paradigm shifts in how you access modules. Again, everything <strong>should</strong> be backwards compatible, and this guide is meant to teach adoption of the new available patterns (which will likely be adopted for Dojo 2.0 ... so there&#8217;s that)</p>
<div class="section" id="loading-dojo">
<h3>Loading Dojo<a class="headerlink" href="#loading-dojo" title="Permalink to this headline">¶</a></h3>
<p>Nothing has changed. For browser environments, point your web browser&#8217;s <tt class="docutils literal"><span class="pre">script</span></tt> element at a <tt class="docutils literal"><span class="pre">dojo.js</span></tt>.</p>
<p>Additionally, there is no longer a special <tt class="docutils literal"><span class="pre">dojo.xd.js</span></tt> file provided on the CDN. The AMD conversion makes <em>every</em> module cross-domain-loadable. In fact, the AMD loader is essentially a stripped down version of the cross-domain loader Dojo has shipped for several years. If you are familiar with, and perhaps already using, Dojo from a cross-domain CDN these new patterns won&#8217;t seem so new.</p>
</div>
<div class="section" id="dojo-require">
<h3>dojo.require<a class="headerlink" href="#dojo-require" title="Permalink to this headline">¶</a></h3>
<p>Previously, one would <tt class="docutils literal"><span class="pre">dojo.require()</span></tt> modules into a page. Take this basic example:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dojo.cookie&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;my.Thinger&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">addOnLoad</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;modules and DOM ready!&quot;</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.require(&quot;dojo.cookie&quot;);
dojo.require(&quot;my.Thinger&quot;);
dojo.addOnLoad(function(){
    alert(&quot;modules and DOM ready!&quot;);
})</textarea></div><p><tt class="docutils literal"><span class="pre">dojo.require</span></tt> has been replaced simply with <tt class="docutils literal"><span class="pre">require()</span></tt>. This is provided by loading <tt class="docutils literal"><span class="pre">dojo.js</span></tt>, as always. The same example redone with Dojo 1.7 would look like:</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo/cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;my/Thinger&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cookie</span><span class="p">,</span> <span class="nx">Thinger</span><span class="p">){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;wait! DOM might not be ready yet?!&quot;</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">require([&quot;dojo/cookie&quot;, &quot;my/Thinger&quot;], function(cookie, Thinger){
    alert(&quot;wait! DOM might not be ready yet?!&quot;)
});</textarea></div><p>The <tt class="docutils literal"><span class="pre">require()</span></tt> call follows the <a class="reference external" href="http://requirejs.org/docs/api.html">requirejs</a> API. It does lots of amazing things. That is beyond the scope of this document, currently.</p>
<p>Take notice of the difference in the two examples:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">dojo.require</span></tt> takes a dot-separated module name, <tt class="docutils literal"><span class="pre">require()</span></tt> takes a forward-slash separated module name</li>
<li><tt class="docutils literal"><span class="pre">require()</span></tt> takes a function parameter, acting as a callback.</li>
<li>the alert in the <tt class="docutils literal"><span class="pre">require()</span></tt> callback says DOM isn&#8217;t ready? huh?</li>
<li>the <tt class="docutils literal"><span class="pre">require()</span></tt> callback is passed arguments. I named them <cite>cookie</cite> and <cite>Thinger</cite></li>
</ul>
<p>The module name conversion should be self-explanatory. Both point to some resource on disk. In this case <tt class="docutils literal"><span class="pre">dojo/cookie.js</span></tt> and <tt class="docutils literal"><span class="pre">my/Thinger.js</span></tt>. Both loaders will load the two files (and any dependencies) and execute the code following.</p>
<p>The <tt class="docutils literal"><span class="pre">require()</span></tt> callback function is important. In the former example, we <tt class="docutils literal"><span class="pre">alert()</span></tt> within a <tt class="docutils literal"><span class="pre">dojo.addOnLoad</span></tt> function. In Dojo &lt; 1.7, dojo.addOnLoad meant &#8220;modules and DOM ready&#8221;. With <tt class="docutils literal"><span class="pre">require()</span></tt>, the callback simply means &#8220;the modules you asked for are ready&#8221;, leaving the DOM the be a separate concern. This is easily achieved with the <tt class="docutils literal"><span class="pre">dojo/domReady</span></tt> plugin.</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dojo/cookie&quot;</span><span class="p">,</span> <span class="s2">&quot;my/Thinger&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/domReady!&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cookie</span><span class="p">,</span> <span class="nx">Thinger</span><span class="p">){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;okay, NOW the modules I wanted AND DOM are ready! phew.&quot;</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">require([&quot;dojo/cookie&quot;, &quot;my/Thinger&quot;, &quot;dojo/domReady!&quot;], function(cookie, Thinger){
    alert(&quot;okay, NOW the modules I wanted AND DOM are ready! phew.&quot;);
})</textarea></div><p>So to summarize: instead of calling dojo.require() N times, call require() once, passing an array of module names you want. If you need DOMReady, use <tt class="docutils literal"><span class="pre">&quot;dojo/domReady!&quot;</span></tt>. Note the <tt class="docutils literal"><span class="pre">!</span></tt> following the module name. That puts the <tt class="docutils literal"><span class="pre">dojo/domReady</span></tt> module into &#8220;plugin&#8221; mode.</p>
<p>The special <tt class="docutils literal"><span class="pre">Thinger</span></tt> and <tt class="docutils literal"><span class="pre">cookie</span></tt> variables created for our <tt class="docutils literal"><span class="pre">require()</span></tt> callback are whatever the return values from <tt class="docutils literal"><span class="pre">dojo/cookie.js</span></tt> and <tt class="docutils literal"><span class="pre">my/Thinger.js</span></tt> were, respectively. We will discuss the return value of <tt class="docutils literal"><span class="pre">my/Thinger</span></tt> while we deprecate <a class="reference internal" href="#dojo-provide">dojo.provide</a> in the next section.</p>
</div>
<div class="section" id="dojo-provide">
<h3>dojo.provide<a class="headerlink" href="#dojo-provide" title="Permalink to this headline">¶</a></h3>
<p>Previously, and building on the <a class="reference internal" href="#dojo-require">dojo.require</a> breakdown, one would define a module on disk using <tt class="docutils literal"><span class="pre">dojo.provide</span></tt>:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;my.Thinger&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dijit._Widget&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;my.Thinger&quot;</span><span class="p">,</span> <span class="nx">dijit</span><span class="p">.</span><span class="nx">_Widget</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.provide(&quot;my.Thinger&quot;);
dojo.require(&quot;dijit._Widget&quot;);
dojo.declare(&quot;my.Thinger&quot;, dijit._Widget, {
    // ...
});</textarea></div><p>With Dojo 1.7+, this becomes <tt class="docutils literal"><span class="pre">define()</span></tt>. Easier to show in code than words:</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dojo/_base/declare&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/_Widget&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">declare</span><span class="p">,</span> <span class="nx">_Widget</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">declare</span><span class="p">(</span><span class="nx">_Widget</span><span class="p">,</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([&quot;dojo/_base/declare&quot;, &quot;dijit/_Widget&quot;], function(declare, _Widget){
    return declare(_Widget, {
        // ...
    });
});</textarea></div><p>Ok, so this is where it gets cool. First, <tt class="docutils literal"><span class="pre">define()</span></tt> looks like a <tt class="docutils literal"><span class="pre">require()</span></tt> call: array of dependencies, and a callback function with those dependencies passed, in order. We could &#8220;name&#8221; our module in the <tt class="docutils literal"><span class="pre">define()</span></tt> call, but that takes the &#8220;A&#8221; out of &#8220;AMD&#8221;. Instead, we define some anonymous module that requires Dojo&#8217;s <a class="reference internal" href="../dojo/declare.html#dojo-declare"><em>declare()</em></a> module, and the base Dijit mixin <a class="reference internal" href="../dijit/_Widget.html#dijit-widget"><em>dijit._Widget</em></a>.</p>
<p>The return value of <tt class="docutils literal"><span class="pre">dojo/_base/declare</span></tt> is the old <tt class="docutils literal"><span class="pre">dojo.declare</span></tt> function we know and love. It is available to us as a local variable <tt class="docutils literal"><span class="pre">declare</span></tt>, within the <tt class="docutils literal"><span class="pre">define</span></tt> callback, as is the old <tt class="docutils literal"><span class="pre">dijit._Widget</span></tt> base class we love to inherit from.</p>
<p><tt class="docutils literal"><span class="pre">dojo.provide</span></tt> would expand the passed module name into an object in the global space. eg:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;a.b.c.d.e.f.g&quot;</span><span class="p">);</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.provide(&quot;a.b.c.d.e.f.g&quot;);</textarea></div><p>Would create an object structure like:</p>
<div class="highlight"><pre><span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="p">{</span> <span class="nx">b</span><span class="o">:</span> <span class="p">{</span> <span class="nx">c</span><span class="o">:</span> <span class="p">{</span> <span class="nx">d</span><span class="o">:</span> <span class="p">{</span> <span class="nx">e</span><span class="o">:</span> <span class="p">{</span> <span class="nx">f</span><span class="o">:</span> <span class="p">{</span> <span class="nx">g</span><span class="o">:</span> <span class="p">{}</span> <span class="p">}}}}}}}</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">{ a: { b: { c: { d: { e: { f: { g: {} }}}}}}}</textarea></div><p>Part of the motivation for AMD is to avoid global pollution. You are no longer <tt class="docutils literal"><span class="pre">a.b.c.d.e.f.g</span></tt>: you are whatever you return from your module. Above, we are returning the return value of our <tt class="docutils literal"><span class="pre">dojo/_base/declare</span></tt> call, which turns out to be whatever it is we <tt class="docutils literal"><span class="pre">declare'd</span></tt>. Like magic, a completely nameless/global-less &#8220;Class&#8221;, available to anyone. When someone calls:</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;my/Thinger&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Thinger</span><span class="p">){</span>
    <span class="k">new</span> <span class="nx">Thinger</span><span class="p">();</span> <span class="c1">//</span>
<span class="p">})</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">require([&quot;my/Thinger&quot;], function(Thinger){
    new Thinger(); //
})</textarea></div><p>They are creating a new instance of whatever it is you returned.</p>
</div>
<div class="section" id="dojo-cache">
<h3>dojo.cache<a class="headerlink" href="#dojo-cache" title="Permalink to this headline">¶</a></h3>
<p>Most commonly used with <tt class="docutils literal"><span class="pre">dijit._Templated</span></tt>, dojo.cache reads local resources from a tree and makes them available to your JavaScript in a variable.</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;a.b.C&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;a.b.C&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateString</span><span class="o">:</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">cache</span><span class="p">(</span><span class="s2">&quot;a.b&quot;</span><span class="p">,</span> <span class="s2">&quot;templates/C.html&quot;</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.provide(&quot;a.b.C&quot;);
dojo.declare(&quot;a.b.C&quot;, null, {
    templateString: dojo.cache(&quot;a.b&quot;, &quot;templates/C.html&quot;)
});</textarea></div><p>The resource at <tt class="docutils literal"><span class="pre">a/b/templates/C.html</span></tt> would be loaded immediately, and used to populate the <tt class="docutils literal"><span class="pre">templateString</span></tt> variable. In Dojo 1.7+ this is done with the <tt class="docutils literal"><span class="pre">dojo/text!</span></tt> plugin. Pass the module name as the parameter to the plugin, and the return value is transferred to the variable in the callback. Here is it <tt class="docutils literal"><span class="pre">template</span></tt>:</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dojo/_base/declare&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/text!a/b/templates/C.html&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">declare</span><span class="p">,</span> <span class="nx">template</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;a.b.C&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">templateString</span><span class="o">:</span> <span class="nx">template</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([&quot;dojo/_base/declare&quot;, &quot;dojo/text!a/b/templates/C.html&quot;], function(declare, template){
    return declare(&quot;a.b.C&quot;, null, {
        templateString: template
    })
});</textarea></div></div>
<div class="section" id="dojo-ready">
<h3>dojo.ready<a class="headerlink" href="#dojo-ready" title="Permalink to this headline">¶</a></h3>
<p>As seen in the <a class="reference internal" href="#dojo-require">dojo.require</a> section, <tt class="docutils literal"><span class="pre">dojo.ready</span></tt> (an alias to <tt class="docutils literal"><span class="pre">dojo.addOnLoad</span></tt>) no longer considers DOM-readiness. Or rather: The <tt class="docutils literal"><span class="pre">require()</span></tt> callback is <strong>not</strong> synonymous with <tt class="docutils literal"><span class="pre">document.ready</span></tt>. The <tt class="docutils literal"><span class="pre">require()</span></tt> callback <strong>only</strong> considers modules and plugins. To accomplish &#8220;modules and DOM ready&#8221; you have a couple of options:</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;a/b/C&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/domReady!&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">C</span><span class="p">){</span>
    <span class="k">new</span> <span class="nx">C</span><span class="p">().</span><span class="nx">placeAt</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">require([&quot;a/b/C&quot;, &quot;dojo/domReady!&quot;], function(C){
    new C().placeAt(document.body)
});</textarea></div><p>Above the module a/b/C.js is loaded, and the <tt class="docutils literal"><span class="pre">new</span></tt> call is deferred until <tt class="docutils literal"><span class="pre">document.ready</span></tt>. Next, we&#8217;ll look at the <tt class="docutils literal"><span class="pre">dojo/ready</span></tt> module (not a plugin):</p>
<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;a/b/C&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/ready&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/_base/declare&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">C</span><span class="p">,</span> <span class="nx">ready</span><span class="p">,</span> <span class="nx">declare</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">D</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="nx">C</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">newProp</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">});</span>

    <span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// DOM nao!</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">require([&quot;a/b/C&quot;, &quot;dojo/ready&quot;, &quot;dojo/_base/declare&quot;], function(C, ready, declare){

    var D = declare(C, {
        newProp: 10
    });

    ready(function(){
        // DOM nao!
    });
});</textarea></div><p>In this example we loaded the <tt class="docutils literal"><span class="pre">declare</span></tt>, <tt class="docutils literal"><span class="pre">a/b/C.js</span></tt> and <tt class="docutils literal"><span class="pre">dojo/ready</span></tt> modules. When all the module dependencies are loaded our <tt class="docutils literal"><span class="pre">require()</span></tt> callback fires. <em>Then</em>, we register another function by calling <tt class="docutils literal"><span class="pre">ready()</span></tt> (the return value from <tt class="docutils literal"><span class="pre">dojo/ready</span></tt>, in the second position)</p>
</div>
</div>
<div class="section" id="the-hands-off-approach">
<h2><a class="toc-backref" href="#id4">The Hands off Approach</a><a class="headerlink" href="#the-hands-off-approach" title="Permalink to this headline">¶</a></h2>
<p>It may be possible for you to convert much of your codebase into AMD-compatible goodness in a mostly automated fashion. Or rather: the method described in the coming sections will modify much of your existing code, making it passable as AMD-ready, though the devil is in the details, and some guidance is needed.</p>
<p>The secret is to run a build. Running a build over a legacy application codebase will create output wrapped in AMD (somewhat poorly, but backwards compatible). This is the first step into having a truly anonymous/granular source tree.</p>
<div class="section" id="running-a-build">
<h3>Running a build<a class="headerlink" href="#running-a-build" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s take a simple module, and build it.
(Again, this guide assumes you have a build plan in place and have existing code using 1.6 we want to convert)</p>
<p>Our sample module looks like this:</p>
<div class="highlight"><pre><span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;my.HotApplication&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;my.HotController&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dijit._Widget&quot;</span><span class="p">);</span>

<span class="nx">dojo</span><span class="p">.</span><span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;my.HotApplication&quot;</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">HotController</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateString</span><span class="o">:</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">cache</span><span class="p">(</span><span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="s2">&quot;templates/HotApplication.html&quot;</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">dojo.provide(&quot;my.HotApplication&quot;);
dojo.require(&quot;my.HotController&quot;);
dojo.require(&quot;dijit._Widget&quot;);

dojo.declare(&quot;my.HotApplication&quot;, my.HotController, {
    templateString: dojo.cache(&quot;my&quot;, &quot;templates/HotApplication.html&quot;)
});</textarea></div><p>It is conveniently located in a <tt class="docutils literal"><span class="pre">my/</span></tt> folder with <tt class="docutils literal"><span class="pre">dojo/</span></tt> and <tt class="docutils literal"><span class="pre">dijit/</span></tt> siblings.  First step is to run a build, but remember to turn off all optimizations:</p>
<div class="highlight-python"><pre>$ ./build.sh profile=myprofile cssOptimize=0 optimize=0 layerOptimize=0 copyTests=1 mini=0 version=...</pre>
</div>
<p>It might be a good idea to turn <tt class="docutils literal"><span class="pre">stripConsole</span></tt> off as well. Running this build will result in a new file tree including your newly AMD'ified <tt class="docutils literal"><span class="pre">my/</span></tt> folder. Looking at the new <tt class="docutils literal"><span class="pre">HotApplication.js</span></tt> file we see:</p>
<div class="highlight"><pre><span class="c1">//&gt;&gt;built</span>
<span class="nx">define</span><span class="p">(</span><span class="s2">&quot;my/HotApplication&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">&quot;dojo&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit&quot;</span><span class="p">,</span> <span class="s2">&quot;dojox&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/require!my/HotController&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit/_Widget&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dojo/text!my/templates/HotApplication.html&quot;</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dojo</span><span class="p">,</span> <span class="nx">dijix</span><span class="p">,</span> <span class="nx">dojox</span><span class="p">){</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="s2">&quot;my.HotApplication&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;my.HotController&quot;</span><span class="p">);</span>
<span class="nx">dojo</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dijit._Widget&quot;</span><span class="p">);</span>

<span class="nx">dojo</span><span class="p">.</span><span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;my.HotApplication&quot;</span><span class="p">,</span> <span class="nx">my</span><span class="p">.</span><span class="nx">HotController</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">templateString</span><span class="o">:</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">cache</span><span class="p">(</span><span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="s2">&quot;templates/HotApplication.html&quot;</span><span class="p">)</span>
<span class="p">});</span>
<span class="p">});</span>
<span class="c1">//&gt;&gt;built</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">//&gt;&gt;built
define(&quot;my/HotApplication&quot;, [
    &quot;dojo&quot;, &quot;dijit&quot;, &quot;dojox&quot;, &quot;dojo/require!my/HotController&quot;, &quot;dijit/_Widget&quot;,
    &quot;dojo/text!my/templates/HotApplication.html&quot;
], function(dojo, dijix, dojox){
dojo.provide(&quot;my.HotApplication&quot;);
dojo.require(&quot;my.HotController&quot;);
dojo.require(&quot;dijit._Widget&quot;);

dojo.declare(&quot;my.HotApplication&quot;, my.HotController, {
    templateString: dojo.cache(&quot;my&quot;, &quot;templates/HotApplication.html&quot;)
});
});
//&gt;&gt;built</textarea></div><p>See what has happened? First, our module is no longer anonymous: given the name <tt class="docutils literal"><span class="pre">my/HotApplication</span></tt> ... Next, the first three dependencies listed are simply <tt class="docutils literal"><span class="pre">dojo</span></tt>, <tt class="docutils literal"><span class="pre">dijit</span></tt> and <tt class="docutils literal"><span class="pre">dojox</span></tt> ... This is a backwards-compatibility require which populates the global <tt class="docutils literal"><span class="pre">dojo</span></tt> and <tt class="docutils literal"><span class="pre">dijit</span></tt> objects, so you can continue to use calls like <cite>dojo.declare &lt;dojo/declale&gt;</cite> and <cite>dojo.byId &lt;dojo/byId&gt;</cite> without having to know which base module to pick from.</p>
<p>We also see a special plugin <tt class="docutils literal"><span class="pre">dojo.require!</span></tt> used to load &quot;all the rest of the modules you required previously&quot;. This is a comma separated list of modules to load, all in a single string.</p>
</div>
<div class="section" id="manual-conversion">
<h3>Manual Conversion<a class="headerlink" href="#manual-conversion" title="Permalink to this headline">¶</a></h3>
<p>First, let's remove the <tt class="docutils literal"><span class="pre">//&gt;&gt;built</span></tt> pragmas, as we are essentially un-building our newly converted module. Then remove the define() name, &quot;my/HotApplication&quot;, returning the module to be anonymous, and capable of moving around on disk without modification.</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dojo&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit&quot;</span><span class="p">,</span> <span class="s2">&quot;dojox&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/require!........&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dojo</span><span class="p">,</span> <span class="nx">dijix</span><span class="p">,</span> <span class="nx">dojox</span><span class="p">){</span>

<span class="p">})</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([&quot;dojo&quot;, &quot;dijit&quot;, &quot;dojox&quot;, &quot;dojo/require!........&quot;], function(dojo, dijix, dojox){

})</textarea></div><p>Now, unless we're using the object we create by calling <tt class="docutils literal"><span class="pre">dojo.provide</span></tt> we can remove that as well. If we need to continue populating the global space, you can continue to use <tt class="docutils literal"><span class="pre">provide</span></tt>, or take the shortcut of using <tt class="docutils literal"><span class="pre">dojo.getObject</span></tt>.</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dojo&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dojo</span><span class="p">){</span>
    <span class="c1">// FIXME: actually look up this call</span>
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">getObject</span><span class="p">(</span><span class="s2">&quot;HotApplication&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;my&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([&quot;dojo&quot;], function(dojo){
    // FIXME: actually look up this call
    var obj = dojo.getObject(&quot;HotApplication&quot;, true, &quot;my&quot;)
    return obj;
});</textarea></div><p>There is no need to duplicate modules in a <tt class="docutils literal"><span class="pre">dojo.require()</span></tt> call versus a <tt class="docutils literal"><span class="pre">dojo/require!</span></tt> plugin, so remove the former. Additionally, if you'd like to eliminate the <tt class="docutils literal"><span class="pre">dojo.require!</span></tt> plugin all together simply remove it, expanding out the items into new <tt class="docutils literal"><span class="pre">define</span></tt> dependencies:</p>
<div class="highlight"><pre><span class="nx">define</span><span class="p">([</span>
    <span class="s2">&quot;dojo&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit&quot;</span><span class="p">,</span> <span class="s2">&quot;dojox&quot;</span><span class="p">,</span> <span class="s2">&quot;my/HotController&quot;</span><span class="p">,</span> <span class="s2">&quot;dijit._Widget&quot;</span><span class="p">,</span> <span class="s2">&quot;dojo/text!my/templates/HotApplication.html&quot;</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dojo</span><span class="p">,</span> <span class="nx">dijit</span><span class="p">,</span> <span class="nx">dojox</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="nx">_Widget</span><span class="p">,</span> <span class="nx">template</span><span class="p">){</span>

    <span class="k">return</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">declare</span><span class="p">(</span><span class="s2">&quot;my.HotApplication&quot;</span><span class="p">,</span> <span class="nx">Controller</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">templateString</span><span class="o">:</span> <span class="nx">template</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>
<div class="CodeGlassMiniRaw" label="" lang="javascript"><textarea style="display:none">define([
    &quot;dojo&quot;, &quot;dijit&quot;, &quot;dojox&quot;, &quot;my/HotController&quot;, &quot;dijit._Widget&quot;, &quot;dojo/text!my/templates/HotApplication.html&quot;
], function(dojo, dijit, dojox, Controller, _Widget, template){

    return dojo.declare(&quot;my.HotApplication&quot;, Controller, {
        templateString: template
    });

});</textarea></div><p>Now we need to goto <tt class="docutils literal"><span class="pre">my/HotController.js</span></tt> and ensure it is properly using a <tt class="docutils literal"><span class="pre">define()</span></tt> call, and returning the class previously living at <tt class="docutils literal"><span class="pre">my.HotController</span></tt> (now referenced locally as <tt class="docutils literal"><span class="pre">Controller</span></tt>)</p>
</div>
</div>
</div>


                        </div>
                    </div>
                    <div class="sidebar unit size1of4 lastUnit">
                        <h4>Reference Guide</h4>
						<div id="dtkVersion">
							<label for="refver">Dojo Version</label>
							<select id="refver" name="refver">
								<option value="1.6">1.6</option>
								<option value="1.7">1.7</option>
								<option value="1.8" selected="selected">1.8</option>
                                <option value="1.9">1.9</option>
							</select>
						</div>
                        <ul>
                            <li><a href="../index.html">Startpage</a></li>
                            <li><a href="../dojo/index.html">Dojo</a></li>
                            <li><a href="../dijit/index.html">Dijit</a></li>
                            <li><a href="../dojox/index.html">DojoX</a></li>
                        </ul>
                        
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Hints about Migrating from 1.x to 1.7</a><ul>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#basic-patterns-changed">Basic Patterns, Changed</a><ul>
<li><a class="reference internal" href="#loading-dojo">Loading Dojo</a></li>
<li><a class="reference internal" href="#dojo-require">dojo.require</a></li>
<li><a class="reference internal" href="#dojo-provide">dojo.provide</a></li>
<li><a class="reference internal" href="#dojo-cache">dojo.cache</a></li>
<li><a class="reference internal" href="#dojo-ready">dojo.ready</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-hands-off-approach">The Hands off Approach</a><ul>
<li><a class="reference internal" href="#running-a-build">Running a build</a></li>
<li><a class="reference internal" href="#manual-conversion">Manual Conversion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Release Notes Dojo Toolkit</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="migration-2.0.html"
                        title="next chapter">Dojo 1.x to 2.0 migration guide</a></p>
    <div id="searchbox" style="display: none">
        <h3>Quick search</h3>
        <form class="search" action="../search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
         </form>
         <p class="searchtip" style="font-size: 90%">
             Enter search terms or a module, class or function name.
         </p>
    </div>
        </div>
      </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="hide" />
        <div id="foot">
            <div class="innerBox">
                <script type="text/javascript">document.write('<a href="https://docs.google.com/spreadsheet/viewform?hl=en_US&amp;formkey=dFlDcHEyaHMwbEd4MFBObkNrX0E1MFE6MQ&amp;entry_0=' + encodeURIComponent(window.location.href) + '">Error in the documentation? Can’t find what you are looking for? Let us know!</a>');</script>
                <div class="footer">
                      &copy; Copyright 2005-2012, Dojo Foundation.
                      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
                </div>
            </div>  
        </div>
        <script src="http://www.google.com/jsapi?key=ABQIAAAAbTW5DVaTIHKHQe5Q75sB0BSaOaO_TgJ5c3mtQFnk5JO2zD5dZBSGHlRJ8HAPlCQCEO_FxSmyNAHSLw" type="text/javascript"></script>
    </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>